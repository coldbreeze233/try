<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>å¼€å¿ƒæ¶ˆæ¶ˆä¹</title>

<style>
html,body {

  text-align: center;
  background-image: url( background.jpg );
  background-repeat: no-repeat;
  background-position: center center;
  background-size: cover;
  width: 1920px;
  height: 1080px;
}

#main {
  background-color: transparent;
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate( -50%, -100% );
  height: 500px;
  width: 1000px;
  border: 10px solid black;
  padding: 10px;
  margin: 10px;
}

#main div {
  position: relative;
  float: left;
  background-color: green;
  border: 2px solid black;
  height: 75px;
  width: 75px;
  margin: 10.5px;
}

#option {
  background-color: transparent;
  position: relative;
  height: 320px;
  width: 80px;
  border: 10px solid black;
  margin: 10px;
  transform: translate( 230%, -162% );
}

#re {
  background-color: transparent;
  position: relative;
  height: 80px;
  width: 80px;
  border: 10px solid black;
  margin: 10px;
  transform: translate( 230%, -462% );
}

#rank {
  background-color: transparent;
  position: relative;
  height: 500px;
  width: 60px;
  border: 10px solid black;
  padding: 10px;
  margin: 10px;
  transform: translate( 1600%, -188% );
}

#r {
  color: snow;
  font-size: 16px;
  font-weight: bold;
}

p {
  text-align: center;
  color: red;
  font-size: 40px;
}

button {
  background: url( restart.jpg ); 
  width: 80px; 
  height: 80px; 
  background-position: center center;
  background-size: cover;
}
</style>

<script> //ä¹‹å‰çš„é‚£ä¸ªæ‹–åŠ¨æ³•é™¤äº†èŠ±å“¨å…¶ä»–éƒ½éš¾é¡¶ï¼Œçœ‹äº†å¤§é‡å¹²è´§åæˆ‘å†³å®šæ›´æ¢ä¸ºå¸¸ç”¨çš„åæ ‡æ ‡è®°æ³•ï¼ŒåŸºæœ¬æ˜¯å®Œå…¨é‡æ–°å¼€è‚
var lastx=0;
var lasty=0;
var mouseDown=0;
var scanx=0;
var scany=0;
var scanLastx=0;
var scanLasty=0;
var clearx=0;
var cleary=0;
var clearLastx=0;
var clearLasty=0;
var mid1=0;
var mid2=0
var coordinate1=0;
var coordinate2=0;
var scanx_right=0;
var scany_right=0;
var scanLastx_right=0;
var scanLasty_right=0;
var DOL=0;
var imgLocate=new Array();
var target=new Array();
var imgs=new Array("a0.jpg","a1.jpg","a2.jpg","a3.jpg","a4.jpg","a5.jpg");//æˆå †çš„å˜é‡ï¼Œå…¶å®åº”è¯¥å¯ä»¥ç®€åŒ–ä¸€ä¸‹ï¼Œæˆ‘ä¼šåç»­å°è¯•

//é‡å¼€ï¼ˆå¼€å±€ï¼‰ä»£ç ï¼Œæ¯”ä¹‹å‰é‚£ä¸ªå…‹éš†+éšæœºæ›´æ”¹å›¾ç‰‡è¦é«˜å¤§ä¸Šä¸€äº›
function restart(){
    var x=document.getElementById("main"); 
    x.innerHTML="";
    mouseDown=0;
    for(var i = 0; i < 5; i++){
        imgLocate[i] = new Array();
        for (var j = 0; j < 10; j++) {
            imgLocate[i][j] ="";
        }//ä¸ºæ¯ä¸€ä¸ªå›¾ç‰‡éƒ½å‡†å¤‡å¥½å±äºè‡ªå·±çš„imgLocate[i][j]ä½œä¸ºåˆ¤æ–­ä¾æ®
    }
    for(var i = 0; i < 5; i++){
        for( var j = 0; j < 10; j++) {
            imgLocate[i][j] = Math.floor(Math.random()*6);
            x.innerHTML += "<div name='base' onclick='exchange(" + i + "," + j + ")'><img width='75px' height='75px' src='" + imgs[imgLocate[i][j]]+ "' ></div>";
        }
    }//æ¯ä¸€ä¸ªimgLocate[i][j]å¯¹åº”ä¸€ä¸ªæ•°å­—ï¼Œæ¯ä¸ªæ•°å­—å¯¹åº”ä¸€ä¸ªå›¾ç‰‡ï¼Œæ’å…¥å«æœ‰ä¸“å±æ ‡è®°åŠå›¾ç‰‡çš„div*50
    scanAll()//å¼€å±€å›¾ç‰‡éšæœºç”Ÿæˆï¼Œä¸ºé¿å…é‡å¤ä»¥æ­¤æ¶ˆé™¤
}

//äº¤æ¢ä»£ç ï¼Œç»¼åˆæ‰€æœ‰ç‚¹å‡»æƒ…å†µç»™äºˆå¯¹åº”å›åº”
function exchange(x,y){
    if (mouseDown == 0){
        lastx = x;
        lasty = y;
    }//æ€»ä¹‹å…ˆæŠŠç¬¬ä¸€æ¬¡ç‚¹å‡»çš„ç»“æœè®°ä¸‹æ¥
    mouseDown++;
    if(mouseDown == 2 && lastx == x && lasty == y){
        mouseDown=1;
        alert("Â¿ä½ å†ç‚¹");
    }//ç‚¹å‡»åŒä¸€å›¾ç‰‡
    if(mouseDown==2){
        if(Math.abs(lasty - y) == 1 || Math.abs(lastx - x) == 1){//ç‚¹å‡»ç›¸é‚»å›¾ç‰‡
            if(Math.abs(lasty - y) == 1 && Math.abs(lastx - x) == 1){
                mouseDown=0;
                alert("å¯¹è§’çº¿æ³•åˆ™ä¸å¯å–")
            }//å¯¹è§’çº¿ç›¸é‚»å¯¹è±¡
            else{
                alert("äº¤æ¢");
                mid1=imgLocate[x][y];
                mid2=imgLocate[lastx][lasty];
                imgLocate[lastx][lasty]=mid1;
                imgLocate[x][y]=mid2;
                target=document.getElementsByName("base");
                coordinate1=x*10+y;
                target[coordinate1].innerHTML="<img width='75px' height='75px' src='" + imgs[mid2] +"'>";
                coordinate2=lastx*10+lasty;
                target[coordinate2].innerHTML="<img width='75px' height='75px' src='" + imgs[mid1] + "'>";
                scan(x,y);
                remove(x,y);
                mouseDown=0;
            }//å·¦å³ä¸Šä¸‹ç›¸é‚»å¯¹è±¡ï¼Œäº¤æ¢å›¾ç‰‡åŠå¯¹åº”æ•°æ®
        } 
        else{
            alert("ä¸ä¼šå¤ªè¿œäº†ğŸ´");//å…¶ä½™æƒ…å†µï¼ˆä¸ç›¸é‚»ï¼‰
            mouseDown=0;
        }
    }
}

//è¶…é•¿åˆ¤æ–­è¯­å¥é¢„è­¦ã€‚è®²çœŸè¿™é‡Œæ˜¯çœŸçš„è¿‡é•¿äº†ï¼Œåº”è¯¥ç¼©å‡ä¸€ä¸‹ï¼Œä½†æˆ‘åˆšå¼€å§‹å…¶å®æ²¡é¢„æ–™åˆ°ä¼šè¿™ä¹ˆé•¿çš„ï¼ˆåˆšå¼€å§‹åªè€ƒè™‘äº†xï¼Œyçš„æƒ…å†µï¼‰
function scan(x,y){
    for(var a=0;;a++){
        scanx=x-a;
        if(scanx<0 || imgLocate[scanx][y] != imgLocate[x][y]){
            break;
        }
        else if(imgLocate[scanx][y] == imgLocate[x][y]){
            clearx++;    
        }
    }//å¯»æ‰¾å¹¶è®°å½•ä¸å›¾ç‰‡xyä¸Šæ–¹ç›¸è¿çš„æœ€è¿œç›¸åŒå›¾ç‰‡åæ ‡ï¼Œå¹¶è®°å½•ç›¸è¿æ•°ç›®
    for(var a=1;;a++){
        scanx_right=x+a;
        if(x+a>4 || imgLocate[scanx_right][y] != imgLocate[x][y]){
            break;
        }
        else if(imgLocate[scanx_right][y] == imgLocate[x][y]){
            clearx++;
        }
    }//å¯»æ‰¾å¹¶è®°å½•ä¸å›¾ç‰‡xyä¸‹æ–¹ç›¸è¿çš„æœ€è¿œç›¸åŒå›¾ç‰‡åæ ‡ï¼Œå¹¶è®°å½•ç›¸è¿æ•°ç›®
    for(var a=0;;a++){
        scanLastx=lastx-a;
        if(scanLastx<0 || imgLocate[scanLastx][lasty] != imgLocate[lastx][lasty]){
            break;
        }
        else if(imgLocate[scanLastx][lasty] == imgLocate[lastx][lasty]){
            clearLastx++
        }
    }//åé¢çš„å°±æ˜¯lastxï¼ŒlastyåŠxyå·¦å³çš„åˆ¤å®šï¼Œæ ¼å¼åŸºæœ¬ä¸€æ ·
    for(var a=1;;a++){
        scanLastx_right=lastx+a;
        if(lastx+a>4 || imgLocate[scanLastx_right][lasty] != imgLocate[lastx][lasty]){
            break;
        }
        else if(imgLocate[scanLastx_right][lasty] == imgLocate[lastx][lasty]){
            clearLastx++
        }
    }
    for(var a=0;;a++){
        scany=y-a;
        if(scany<0 || imgLocate[x][scany] != imgLocate[x][y]){
            break;
        }
        else if (imgLocate[x][scany] == imgLocate[x][y]){
            cleary++;
        }
    }
    for(var a=1;;a++){
        scany_right=y+a;
        if(y+a>9 || imgLocate[x][scany_right] != imgLocate[x][y]){
            break;
        }
        else if(imgLocate[x][scany_right] == imgLocate[x][y]){
            cleary++;
        }
    }
    for(var a=0;;a++){
        scanLasty=lasty-a;
        if(scanLasty<0 || imgLocate[lastx][scanLasty] != imgLocate[lastx][lasty]){
            break;
        }
        else if(imgLocate[lastx][scanLasty] == imgLocate[lastx][lasty]){
            clearLasty++;
        }
    }
    for(var a=1;;a++){
        scanLasty_right=lasty+a;
        if(lasty+a>9 || imgLocate[lastx][scanLasty_right] != imgLocate[lastx][lasty]){
            break;
        }
        else if(imgLocate[lastx][scanLasty_right] == imgLocate[lastx][lasty]){
            clearLasty++;
        }
    }
    if(clearx < 3){
        clearx=0;
        scanx=0;
        scanx_right=0;
    }//ç›¸åŒæ•°ç›®å°äº3åˆ™é‡ç½®
    if(clearLastx < 3){
        clearLastx=0;
        scanLastx=0;
        scanLastx_right=0;
    }//ä»¥ä¸‹åŒä¸Š
    if(cleary < 3){
        cleary=0;
        scany=0;
        scany_right=0;
    }
    if(clearLasty < 3){
        clearLasty=0;
        scanLasty=0;
        scanLasty_right=0;
    }
    if(clearx == 0 && cleary == 0 && clearLastx == 0 && clearLasty == 0){
        imgLocate[lastx][lasty]=mid2;
        imgLocate[x][y]=mid1;
        target[coordinate1].innerHTML="<img width='75px' height='75px' src='" + imgs[mid1] + "'>";
        target[coordinate2].innerHTML="<img width='75px' height='75px' src='" + imgs[mid2] + "'>";     
    }//å¦‚æœä¸Šä¸‹å·¦å³éƒ½ä¸æ»¡è¶³3ï¼Œå°±æ¢å›å»
}

//æ¥ä¸‹æ¥å°±æ˜¯å–œé—»ä¹è§çš„äº¤æ¢æ—¶é—´ï¼Œæ›´æ¢ç¬¦åˆæ¡ä»¶çš„å›¾ç‰‡ä¸ºâ€œå“¦è±ï¼Œå®Œè›‹â€ï¼Œå¹¶ç»™äºˆidï¼ˆåŸè®¡åˆ’ç”¨äºå¢æ·»çš„è¯†åˆ«æ ‡è®°ï¼‰
function remove(x,y){
    scanx=scanx+1;
    scany=scany+1;
    scanLastx=scanLastx+1;
    scanLasty=scanLasty+1;
    if(clearx >= 3){
        for(var a=0;a<clearx;a++){
            target=document.getElementsByName("base");
            coordinate1=scanx*10+a*10+y;
            target[coordinate1].innerHTML="<img id='dead' width='75px' height='75px' src='dead.jpg'>";
        }
    }
    if(clearLastx >= 3){
        for(var a=0;a<clearLastx;a++){
            target=document.getElementsByName("base");
            coordinate2=scanLastx*10+a*10+lasty;
            target[coordinate2].innerHTML="<img id='dead' width='75px' height='75px' src='dead.jpg'>";
        }
    }
    if(cleary >= 3){
        for(var a=0;a<cleary;a++){
            target=document.getElementsByName("base");
            coordinate1=x*10+scany+a;
            target[coordinate1].innerHTML="<img id='dead' width='75px' height='75px' src='dead.jpg'>";
        }
    }
    if(clearLasty >= 3){
        for(var a=0;a<clearLasty;a++){
            target=document.getElementsByName("base");
            coordinate2=lastx*10+scanLasty+a;
            target[coordinate2].innerHTML="<img id='dead' width='75px' height='75px' src='dead.jpg'>";
        }
    }
    clearx=0;
    clearLastx=0;
    cleary=0;
    clearLasty=0;//é‡ç½®ç¬¦åˆçš„æ¶ˆé™¤æ•°ç›®
    addImg()
}

//å…¨ç›˜æ‰«æä»£ç ï¼Œæ‰§è¡Œäºå¼€å±€åŠæ–°ç”Ÿæˆå›¾ç‰‡å
function scanAll(){
    lastx=0;
    lasty=0;
    for(var i=0;i<5;i++){
        for(var j=0;j<10;j++){
            lastx=0,lasty=0;
            coordinate2=0;
            coordinate1=i*10+j;
            mid1=imgLocate[i][j];
            mid2=imgLocate[lastx][lasty];
            target=document.getElementsByName("base");
            scan(i,j);
            remove(i,j);//è¿™é‡Œç”±äºäº¤æ¢åŠæ¶ˆé™¤è®¾è®¡é—®é¢˜ï¼Œæˆ‘åªèƒ½å°†lastxlastyå›¾ç‰‡å›ºå®šä¸ºç¬¬ä¸€å¼ ï¼Œå¯¹åä¸€ä»½å›¾ç‰‡è¿›è¡Œé€æ­¥æ‰«æ
        }
    }
}

//è¿™é‡ŒçœŸçš„æœ‰é¬¼...å‘¨äº”çš„æ—¶å€™è¿™ç©æ„é¢‘å‡ºbugä»¥è‡³äºæˆ‘æŠŠå®ƒå°å°äº†èµ·æ¥ï¼Œç»“æœå‘¨å…­é‡æ–°è¿è¡Œä¹‹ååˆæ²¡é—®é¢˜äº†ï¼Œæˆ‘ï¼Ÿï¼Ÿï¼Ÿéš¾é“æ˜¯æˆ‘å½“æ—¶æ’å…¥çš„ä½ç½®ä¸å¯¹ï¼Ÿ
function addImg(){
    DOL=0;
    for(var i=0;i<5;i++){
        for(var j=0;j<10;j++){
            target=document.getElementsByName("base")[i*10+j];
            var adds=document.getElementsByName("base")[i*10+j].getElementsByTagName("img")[0].getAttribute("id");
            if(adds != null ){//å¤§ä½¬è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œåˆšå¼€å§‹æ—¶æˆ‘çš„åˆ¤æ–­è¯­å¥æ˜¯å·¦å­—ç¬¦ä¸²ç­‰äºå³å­—ç¬¦ä¸²ï¼ˆå³dead==deadï¼‰ï¼Œä½†å´æ— æ³•æ‰§è¡Œä¸‹è¿°æ“ä½œ
                imgLocate[i][j] = Math.floor(Math.random()*6);
                target.innerHTML = "<img width=75px height=75px src='" + imgs[imgLocate[i][j]]+ "'>";
                DOL++;
            }//ä¸æ˜¯æ— æ³•åˆ¤æ–­ï¼Œç”¨alertéªŒè¯ç¡®å®èƒ½è¿”å›deadå­—ç¬¦ä¸²ï¼Œä¸”åˆ¤æ–­è¯­å¥ä¸æŠ¥é”™ï¼ˆä½†å¿…é¡»å»é™¤æ‰€æœ‰DOLæœ‰å…³è¯­å¥ï¼Œå¦åˆ™æœªå¿…å¼¹å‡ºalertï¼‰
        }
    } 
    if(DOL>0) {
        scanAll();
    }
}

function music(){
    var playAudio=document.getElementsByTagName("audio")[0];
    if(playAudio.paused){
        playAudio.play();
    }
    else{
        playAudio.pause();
    }
}//éŸ³ä¹å¼€å…³ï¼Œé€šè¿‡è·å–éŸ³ä¹æ’­æ”¾ä¿¡æ¯å†³å®šæ˜¯å¦æ’­æ”¾

function volumeUp(){
    var audioVolume=document.getElementsByTagName("audio")[0];
    audioVolume.volume=audioVolume.volume+0.1
}//éŸ³é‡å¢å¤§

function volumeDown(){
    var audioVolume=document.getElementsByTagName("audio")[0];
    audioVolume.volume=audioVolume.volume-0.1
}//éŸ³é‡å‡å°‘
//åˆ†æ•°ï¼Œæ’è¡Œä»€ä¹ˆçš„ä¹Ÿåœ¨è€ƒè™‘äº†0/100
</script>

</head>

<body>
<p>å¼€å¿ƒ(çŒæ­»)æ¶ˆæ¶ˆä¹</p>
<div id="main" ></div>

<div id="option">
    <img src="open_close.jpg" style="margin-top:10px; margin-bottom:10px;" onclick="music()">
    <img src="up.jpg" style="margin-top:10px; margin-bottom:10px;" onclick="volumeUp()">
    <img src="down.jpg" style="margin-top:10px; margin-bottom:10px;" onclick="volumeDown()">
    <audio id ="music" src="æƒ³ã„å‡ºã¯é ãã®æ—¥ã€….mp3" loop="loop"  ></audio>
</div>

<div id="re">
    <button type="button" onclick="restart()" ></button>
    <p id="r">å¤§ä¾ è¯·é‡æ–°æ¥è¿‡</p>
</div>

<div id="rank">
    <p>æ’è¡Œ</p>
</div>
</body>
</html> 